<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Demojifier</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --gap: 12px; --border:#e5e7eb; --bg:#fafafa; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background: var(--bg); }
    .container { max-width: 1000px; margin: 32px auto; padding: 0 16px; }
    h1 { font-size: 20px; margin: 0 0 16px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: var(--gap); }
    textarea {
      width: 100%; min-height: 240px; resize: vertical; padding: 12px 14px;
      border: 1px solid var(--border); border-radius: 10px; background: white; font-size: 14px; line-height: 1.4;
    }
    .controls { display: flex; gap: var(--gap); margin-top: 12px; align-items: center; }
    button {
      padding: 10px 14px; border-radius: 10px; border: 1px solid var(--border);
      background: white; cursor: pointer; font-weight: 600;
    }
    button.primary { background: black; color: white; border-color: black; }
    .hint { color:#6b7280; font-size:12px; margin-top:6px; }
    .right-col { position: relative; }
    .status {
      position: absolute; top: 8px; right: 10px; font-size: 12px; color: #6b7280;
      background: #f5f5f5; border: 1px solid var(--border); border-radius: 999px; padding: 2px 8px;
    }
    @media (max-width: 800px) { .row { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>Demojifier</h1>
    <div class="row">
      <div>
        <textarea id="input" placeholder="Paste text with emojis here‚Ä¶ e.g. That movie was üî•üî•üòÇ"></textarea>
        <div class="controls">
          <button class="primary" id="convertBtn">Convert</button>
          <button id="clearBtn">Clear</button>
          <label style="margin-left:auto; font-size:13px;">
            <input type="checkbox" id="standardMode" />
            Use rules only (no LLM)
          </label>
        </div>
        <div class="hint">Tip: ‚Äúrules only‚Äù works offline (uses your provided heuristics). With an API key on the server, ‚Äúauto‚Äù tries the LLM + validator then falls back.</div>
      </div>
      <div class="right-col">
        <div class="status" id="status" hidden>ready</div>
        <textarea id="output" placeholder="Converted output appears here‚Ä¶" readonly></textarea>
      </div>
    </div>
  </div>

  <script>
    //const API_BASE = /^https?:/.test(location.origin) ? location.origin: "http://127.0.0.1:8000";
    const API_BASE = "http://127.0.0.1:8000";
    //const API_BASE = (location.hostname === "localhost" ? "http://localhost:8000" : location.origin);
    const input = document.getElementById('input');
    const output = document.getElementById('output');
    const btn = document.getElementById('convertBtn');
    const clear = document.getElementById('clearBtn');
    const statusEl = document.getElementById('status');
    const standardMode = document.getElementById('standardMode');

    function setStatus(text, show=true) {
      statusEl.textContent = text;
      statusEl.hidden = !show;
    }

    clear.addEventListener('click', () => {
      input.value = '';
      output.value = '';
      setStatus('cleared');
      setTimeout(() => setStatus('', false), 700);
    });

    btn.addEventListener('click', async () => {
      const text = input.value.trim();
      if (!text) { output.value = ''; return; }
      setStatus('converting‚Ä¶');
      btn.disabled = true;

      try {
        const res = await fetch(`${API_BASE}/api/convert`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text, mode: standardMode.checked ? 'standard' : 'auto' })
        });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        output.value = data.output || '';
        setStatus(`${data.source} ‚Ä¢ ${data.reason}`);
      } catch (err) {
        output.value = '';
        setStatus('error');
        alert('Conversion failed. Check backend is running.\n\n' + err);
      } finally {
        btn.disabled = false;
        setTimeout(() => setStatus('', false), 2000);
      }
    });
  </script>
</body>
</html>
